<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2A Modas e Perfumes</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/pt.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="success-toast">
        <i class="fas fa-check-circle" style="color: #27ae60;"></i>
        <span id="st-text">Sucesso!</span>
    </div>

    <div id="entry-modal" class="overlay" style="z-index: 10006;">
        <div class="box single-col" style="max-width: 350px; padding: 30px; text-align: center;">
            <i class="fas fa-coins" style="font-size: 2.5rem; color: var(--warning); margin-bottom: 20px;"></i>
            <h3 style="margin-bottom: 10px;">Registrar Entrada</h3>
            <p style="color: #666; font-size: 0.9rem; margin-bottom: 20px;">Informe o valor pago:</p>
            <input type="number" id="entry-val" class="input" placeholder="R$ 0,00" style="text-align: center; font-size: 1.4rem; font-weight: bold; color: var(--success); margin-bottom: 20px;">
            <input type="hidden" id="entry-oid">
            <input type="hidden" id="entry-total">
            <button onclick="admin.confirmEntry()" class="btn-cta" style="width: 100%; font-size: 0.9rem; margin-top:0;">Confirmar</button>
            <button onclick="app.closeModal('entry-modal')" style="background:none; border:none; color:#999; margin-top: 15px; text-decoration: underline;">Cancelar</button>
        </div>
    </div>

    <div id="loading-screen"><i class="fas fa-circle-notch fa-spin fa-2x" style="color:var(--primary);"></i></div>

    <div class="header-floating">
        <button class="login-btn-header" onclick="auth.checkProfile()"><i class="fas fa-user-circle"></i> Conta</button>
        <button class="icon-btn" onclick="app.toggleCart()">
            <i class="fas fa-shopping-bag"></i><span class="badge" id="cart-count">0</span>
        </button>
    </div>

    <div class="hero">
        <img src="logo.jpg" onerror="this.src='https://via.placeholder.com/160?text=2A'">
        <h1 class="brand-font">2A Modas e Perfumes</h1>
        <p>Eleg√¢ncia que transforma.</p>
        <button class="btn-cta" onclick="app.openPromoModal()">‚ú® Ver Promo√ß√µes</button>
    </div>

    <div class="container">
        <div class="filters">
            <button class="filter-btn active" onclick="app.filter('all', this)">Todos</button>
            <button class="filter-btn" onclick="app.filter('feminino', this)">Feminino</button>
            <button class="filter-btn" onclick="app.filter('infantil', this)">Infantil</button>
            <button class="filter-btn" onclick="app.filter('perfumes', this)">Perfumes</button>
        </div>
        <div id="products-list" class="grid"></div>
    </div>

    <footer style="text-align: center; padding: 40px 20px;">
        <button onclick="admin.showLogin()" style="background:none; border:1px solid #ddd; color:#999; padding:5px 15px; font-size:0.75rem; border-radius:20px;">Admin</button>
    </footer>

    <div id="product-modal" class="overlay">
        <div class="box" style="padding: 20px; height: 85vh;">
            <div class="product-modal-grid">
                <div class="pm-images" id="m-media-area"></div>
                <div class="pm-details">
                    <button onclick="app.closeModal('product-modal')" style="align-self: flex-end; border:none; background:none; font-size:1.5rem; color:#ccc;">&times;</button>
                    <small id="m-cat" style="color:var(--primary); font-weight:800; text-transform:uppercase; font-size: 0.75rem;">Categoria</small>
                    <h2 id="m-title" style="font-size: 1.8rem; margin: 5px 0;"></h2>
                    <h3 id="m-price" class="pm-price-tag"></h3>
                    <div style="background:#f9f9f9; padding:15px; border-radius:12px; margin-bottom:20px; font-size: 0.9rem; color: #555;">
                        <p id="m-desc"></p>
                    </div>
                    <label style="font-weight:bold; font-size:0.9rem; display:block; margin-bottom:10px;">Op√ß√µes:</label>
                    <div id="m-vars" class="var-chip-container" style="margin-bottom: 30px;"></div>
                    <div style="margin-top: auto; display: flex; gap: 15px;">
                        <div style="border: 2px solid #eee; border-radius: 30px; display: flex; align-items: center; padding: 0 10px; height: 50px;">
                            <button onclick="app.updQty(-1)" style="border:none; background:none; font-size: 1.2rem; padding: 0 10px;">-</button>
                            <span id="m-qty" style="font-weight:bold; width: 25px; text-align: center;">1</span>
                            <button onclick="app.updQty(1)" style="border:none; background:none; font-size: 1.2rem; padding: 0 10px;">+</button>
                        </div>
                        <button onclick="app.addCart()" class="btn-cta" style="flex:1; height: 50px; margin-top:0;">Adicionar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="sidebar">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:25px;">
            <h2>Sua Sacola</h2>
            <button onclick="app.toggleCart()" style="border:none; background:none; font-size:1.5rem; color:#999;">&times;</button>
        </div>
        <div style="flex:1; overflow-y:auto;">
            <ul id="cart-list" style="list-style:none;"></ul>
            <button onclick="app.toggleCart()" class="btn-continue-shopping">Continuar Comprando</button>
        </div>
        <div style="border-top:1px solid #eee; padding-top:20px;">
            <div id="cart-auth-area" style="margin-bottom:15px;">
                <button onclick="app.showModal('auth-modal')" style="width:100%; padding:12px; background:#f8f9fa; border:1px dashed #ccc; border-radius:12px; font-weight:bold; color:#555;">Fazer Login</button>
            </div>
            <button id="btn-address-trigger" onclick="app.openAddressModal()" class="btn-addr-trigger">üìç Endere√ßo de Entrega</button>
            <div style="display:flex; justify-content:space-between; font-weight:800; font-size:1.2rem; margin: 20px 0;">
                <span>Total</span> <span id="cart-total">R$ 0.00</span>
            </div>
            <button onclick="app.checkout('whatsapp')" class="btn-modern btn-whatsapp" style="width: 100%; margin-bottom: 10px;">Finalizar no WhatsApp</button>
            <button onclick="app.checkout('mercadopago')" class="btn-modern btn-mp" style="width: 100%;">Pagar (Pix/Cart√£o)</button>
        </div>
    </div>

    <div id="admin-auth-modal" class="overlay" style="z-index:10003;">
        <div class="box single-col" style="max-width: 380px;">
            <div style="margin-bottom: 20px; font-size: 3rem; color: var(--accent);"><i class="fas fa-lock"></i></div>
            <h2>Admin 2A</h2>
            <p>Acesso restrito a gestores</p>
            <input type="email" id="admin-email" class="input" placeholder="E-mail" value="loja@2amoda.com">
            <input type="password" id="admin-pass" class="input" placeholder="Senha" onkeydown="if(event.key==='Enter') admin.verifyLogin()">
            <button onclick="admin.verifyLogin()" class="btn-cta" style="width:100%; font-size:0.9rem; margin-top:10px;">Entrar no Painel</button>
            <button onclick="app.closeModal('admin-auth-modal')" style="background:none; border:none; color:#999; text-decoration:underline; margin-top:15px;">Voltar</button>
        </div>
    </div>

    <div id="admin-modal" class="overlay" style="z-index:2001; background:#f0f2f5; align-items:flex-start; padding:0;">
        <div class="box" style="max-width:100%; height:100%; border-radius:0; padding:0; display:flex; flex-direction:column; background:#f0f2f5;">
            
            <div class="admin-nav-grid">
                <div class="nav-card active" onclick="admin.tab('dash', this)">
                    <i class="fas fa-chart-pie"></i><span>Estoque</span>
                </div>
                <div class="nav-card" onclick="admin.tab('clients', this)">
                    <i class="fas fa-users"></i><span>Clientes & Pedidos</span>
                </div>
                <div class="nav-card new-order" onclick="admin.tab('new-order', this)">
                    <i class="fas fa-plus-circle"></i><span>Novo Pedido</span>
                </div>
                <div class="nav-card" onclick="admin.tab('prod', this)">
                    <i class="fas fa-tshirt"></i><span>Produtos</span>
                </div>
                <div class="nav-card" onclick="admin.logout()" style="color: var(--danger); border-color: #fee;">
                    <i class="fas fa-sign-out-alt"></i><span>Sair</span>
                </div>
            </div>

            <div style="flex:1; overflow-y:auto; padding:30px; width:100%; max-width:1200px; margin:0 auto;">
                
                <div id="tab-dash">
                    <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:20px; margin-bottom:30px;">
                        <div style="background:white; padding:20px; border-radius:16px; text-align:center; box-shadow: var(--shadow);">
                            <div style="color:var(--success); font-weight:bold; font-size:0.8rem;">TOTAL VENDA ESTOQUE</div>
                            <div class="stat-val" id="st-rev" style="font-size:1.5rem; font-weight:800;">R$ 0.00</div>
                        </div>
                        <div style="background:white; padding:20px; border-radius:16px; text-align:center; box-shadow: var(--shadow);">
                            <div style="color:var(--danger); font-weight:bold; font-size:0.8rem;">CUSTO TOTAL</div>
                            <div class="stat-val" id="st-cost" style="font-size:1.5rem; font-weight:800;">R$ 0.00</div>
                        </div>
                        <div style="background:white; padding:20px; border-radius:16px; text-align:center; box-shadow: var(--shadow);">
                            <div style="color:var(--info); font-weight:bold; font-size:0.8rem;">ITENS TOTAIS</div>
                            <div class="stat-val" id="st-qty" style="font-size:1.5rem; font-weight:800;">0</div>
                        </div>
                    </div>
                    <div style="background:white; padding:25px; border-radius:16px; box-shadow: var(--shadow);">
                        <h4 style="margin-bottom:20px;">Vis√£o Geral</h4>
                        <div id="dash-stock-grid" class="grid"></div>
                    </div>
                </div>

                <div id="tab-clients" style="display:none;">
                    <div style="max-width: 900px; margin: 0 auto;">
                        <div style="background: linear-gradient(135deg, #2c3e50, #3498db); color: white; padding: 25px; border-radius: 16px; margin-bottom: 25px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.15);">
                            <div style="font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; opacity: 0.9;">Total a Receber</div>
                            <div id="total-receivable" style="font-size: 2.5rem; font-weight: 800; margin-top: 5px;">R$ 0.00</div>
                        </div>
                        <div id="pay-list"></div>
                    </div>
                </div>

                <div id="tab-new-order" style="display:none;">
                    <div style="background:white; padding:30px; border-radius:16px; box-shadow: var(--shadow); max-width: 800px; margin: 0 auto;">
                        <h3>Novo Pedido Manual</h3>
                        <div class="manual-order-grid" style="margin-top:20px;">
                            <div>
                                <h5 style="color:var(--accent);">1. Cliente</h5>
                                <input type="text" id="m-client-name" class="input" placeholder="Nome">
                                <input type="text" id="m-client-phone" class="input" placeholder="WhatsApp">
                                <div class="input-cep-grid">
                                    <input type="text" id="m-client-cep" class="input" placeholder="CEP" onblur="app.fetchCep(this.value, 'manual')">
                                    <small style="display:flex; align-items:center;">Auto</small>
                                </div>
                                <input type="text" id="m-client-street" class="input" placeholder="Rua">
                                <div class="input-row"><input type="text" id="m-client-num" class="input" placeholder="Num"><input type="text" id="m-client-bairro" class="input" placeholder="Bairro"></div>
                                <div class="input-row"><input type="text" id="m-client-city" class="input" placeholder="Cidade"><input type="text" id="m-client-uf" class="input" placeholder="UF"></div>
                            </div>
                            <div>
                                <h5 style="color:var(--accent);">2. Itens</h5>
                                <div class="manual-prod-adder">
                                    <select id="m-prod-select" class="input" style="margin:0; flex:2;"><option value="">Produto...</option></select>
                                    <input type="number" id="m-prod-qty" class="input" value="1" style="margin:0; width:50px; text-align:center;">
                                    <button onclick="admin.addManualItem()" class="btn-modern small">+</button>
                                </div>
                                <div style="text-align:center; margin:5px 0; font-size:0.8rem; font-weight:bold; color:#888;">OU</div>
                                <div class="manual-prod-adder" style="background:#fff5f2; border-color:#eec;">
                                    <input type="text" id="m-custom-item" class="input" placeholder="Item avulso" style="margin:0; flex:2;">
                                    <input type="number" id="m-custom-price" class="input" placeholder="R$" style="margin:0; width:80px;">
                                    <button onclick="admin.addCustomItem()" class="btn-modern small success"><i class="fas fa-plus"></i></button>
                                </div>
                                <div class="manual-cart-list" id="manual-cart-list" style="margin-top:10px; min-height:100px; background:#f9f9f9; padding:10px; border-radius:10px;"></div>
                                <div style="font-size:1.2rem; font-weight:800; text-align:right; margin-top:10px;">Total: <span id="m-total-display">R$ 0.00</span></div>
                            </div>
                        </div>
                        <h5 style="margin-top:20px;">3. Pagamento</h5>
                        <div class="input-row">
                            <select id="m-payment-method" class="input"><option value="Dinheiro">Dinheiro</option><option value="Pix">Pix</option><option value="Cart√£o">Cart√£o</option><option value="Credi√°rio">Credi√°rio</option></select>
                            <select id="m-payment-status" class="input"><option value="Pago">J√° Pago (Total)</option><option value="Pendente">Pendente (A Pagar)</option></select>
                        </div>
                        <button onclick="admin.saveManualOrder()" class="btn-cta" style="width:100%; margin-top:20px; font-size:0.9rem;">Salvar Pedido</button>
                    </div>
                </div>

                <div id="tab-prod" style="display:none;">
                    <div style="background:white; padding:30px; border-radius:16px; margin-bottom:30px; box-shadow: var(--shadow);">
                        <h3>Cadastro de Produto</h3>
                        <input type="hidden" id="edit-id">
                        <input type="text" id="f-name" class="input" placeholder="Nome do Produto">
                        <div style="display:flex; gap:15px;">
                            <select id="f-cat" class="input"><option value="feminino">Feminino</option><option value="infantil">Infantil</option><option value="perfumes">Perfumes</option></select>
                            <input type="number" id="f-cost" class="input" placeholder="Custo Global">
                        </div>
                        <div class="input-row">
                            <input type="number" id="f-price-global" class="input" placeholder="Pre√ßo Venda">
                            <input type="number" id="f-stock-global" class="input" placeholder="Estoque">
                        </div>
                        <div style="margin: 20px 0; display:flex; align-items:center;">
                            <label class="toggle-switch"><input type="checkbox" id="f-promo"><span class="slider"></span></label>
                            <span class="toggle-label" style="margin-left:10px;">Ativar Promo√ß√£o?</span>
                        </div>
                        <div class="file-upload-wrapper" onclick="document.getElementById('f-file').click()">
                            <i class="fas fa-cloud-upload-alt" style="font-size:2rem; color:#ccc;"></i>
                            <p style="margin:5px 0; font-weight:bold;">Adicionar Fotos</p>
                            <input type="file" id="f-file" multiple accept="image/*,video/*" onchange="admin.handleFileSelect(this)">
                        </div>
                        <div id="file-preview-area" class="file-preview-grid"></div>
                        <hr style="margin:25px 0; border:0; border-top:1px solid #eee;">
                        <label style="font-weight:bold; display:block; margin-bottom:10px;">Varia√ß√µes:</label>
                        <span class="checkbox-section-title"><i class="fas fa-palette"></i> Cores</span><div class="modern-checkbox-grid" id="color-checks"></div>
                        <span class="checkbox-section-title"><i class="fas fa-ruler"></i> Tamanhos</span><div class="modern-checkbox-grid" id="volume-checks"></div>
                        <div id="active-vars-area"></div>
                        <textarea id="f-desc" class="input" rows="3" placeholder="Descri√ß√£o" style="margin-top:20px;"></textarea>
                        <div style="display:flex; gap:10px; margin-top:20px;">
                            <button onclick="admin.save()" id="btn-save" class="btn-modern" style="flex:2;">Salvar</button>
                            <button onclick="admin.clear()" class="btn-modern outline" style="flex:1;">Limpar</button>
                        </div>
                    </div>
                    <div style="background:white; padding:25px; border-radius:16px;">
                        <h3>Lista de Produtos</h3>
                        <div id="admin-list" style="margin-top:20px;"></div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div id="address-modal" class="overlay"><div class="box single-col" style="width:100%; max-width:500px; padding:30px;"><h3 style="margin-bottom:20px;">üìç Endere√ßo</h3><div id="saved-addresses-list" style="margin-bottom:20px;"></div><div style="background:#f9f9f9; padding:20px; border-radius:16px;"><h4>Novo Endere√ßo</h4><div class="input-cep-grid"><input type="text" id="addr-cep" class="input" placeholder="CEP" onblur="app.fetchCep(this.value)"><small>Auto</small></div><input type="text" id="addr-street" class="input" placeholder="Rua"><div class="input-row"><input type="text" id="addr-num" class="input" placeholder="N¬∫"><input type="text" id="addr-bairro" class="input" placeholder="Bairro"></div><div class="input-row"><input type="text" id="addr-city" class="input" placeholder="Cidade"><input type="text" id="addr-uf" class="input" placeholder="UF"></div><input type="text" id="addr-ref" class="input" placeholder="Refer√™ncia"><input type="text" id="addr-name" class="input" placeholder="Quem recebe"><input type="text" id="addr-phone" class="input" placeholder="Telefone"><select id="addr-type" class="input"><option value="Casa">Casa</option><option value="Trabalho">Trabalho</option></select><button onclick="app.addNewAddress()" class="btn-modern" style="width:100%;">Salvar</button></div><button onclick="app.closeModal('address-modal')" class="btn-modern outline" style="width:100%; margin-top:10px;">Fechar</button></div></div>
    <div id="promo-modal" class="overlay"><div class="box single-col" style="padding:20px;"><div style="display:flex; justify-content:space-between;"><h3>üî• Ofertas</h3><button onclick="app.closeModal('promo-modal')" style="border:none; background:none; font-size:1.5rem;">&times;</button></div><div id="promo-track" class="promo-list-container"></div></div></div>

    <script src="script.js"></script>
</body>
</html>
