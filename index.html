<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2A Modas | Boutique & Perfumes</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/pt.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700;800&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="success-toast">
        <div class="st-icon-box"><i class="fas fa-check"></i></div>
        <div class="st-msg" id="st-text">Sucesso!</div>
        <div class="st-progress-bg"><div class="st-progress-bar"></div></div>
    </div>

    <div id="entry-modal" class="overlay">
        <div class="box single-col" style="max-width: 350px; padding: 30px; text-align: center;">
            <i class="fas fa-coins" style="font-size: 3rem; color: var(--warning); margin-bottom: 20px;"></i>
            <h3 style="margin-bottom: 10px;">Registrar Pagamento</h3>
            <p style="color: #666; margin-bottom: 20px;">Abatimento ou Entrada</p>
            <input type="number" id="entry-val" class="input" placeholder="R$ 0,00" style="text-align: center; font-size: 1.5rem; margin-bottom: 20px;">
            <input type="hidden" id="entry-oid">
            <input type="hidden" id="entry-total">
            <button onclick="admin.confirmEntry()" class="btn-modern success" style="width: 100%; margin-bottom: 10px;">Confirmar Recebimento</button>
            <button onclick="app.closeModal('entry-modal')" class="btn-modern outline" style="width: 100%;">Cancelar</button>
        </div>
    </div>

    <div id="loading-screen">
        <i class="fas fa-circle-notch fa-spin fa-3x" style="color:var(--primary);"></i>
    </div>

    <div class="header-floating">
        <button class="login-btn-header" onclick="auth.checkProfile()">
            <i class="fas fa-user-circle"></i> Login
        </button>
        <button class="icon-btn" onclick="app.toggleCart()">
            <i class="fas fa-shopping-bag"></i><span class="badge" id="cart-count">0</span>
        </button>
    </div>

    <div class="hero">
        <img src="logo.jpg" onerror="this.src='https://via.placeholder.com/200?text=2A'">
        <h1 class="brand-font">2A Modas e Perfumes</h1>
        <p>ElegÃ¢ncia que transforma. A moda que combina com sua essÃªncia.</p>
        <button class="btn-cta" onclick="app.openPromoModal()">âœ¨ Ver ColeÃ§Ã£o</button>
    </div>

    <div class="container" id="vitrine">
        <div class="filters">
            <button class="filter-btn active" onclick="app.filter('all', this)">Todos</button>
            <button class="filter-btn" onclick="app.filter('feminino', this)">Feminino</button>
            <button class="filter-btn" onclick="app.filter('infantil', this)">Infantil</button>
            <button class="filter-btn" onclick="app.filter('perfumes', this)">Perfumes</button>
        </div>
        <div id="products-list" class="grid"></div>
    </div>

    <footer>
        <p class="brand-font">Â© 2026 2A Modas e Perfumes.</p>
        <br>
        <button onclick="admin.showLogin()">Acesso Restrito (Admin)</button>
    </footer>

    <div id="promo-modal" class="overlay">
        <div class="box single-col" style="max-width:800px; padding: 0;">
            <div style="padding:20px; display:flex; justify-content:space-between; align-items:center; background:#f9f9f9;">
                <h3>ðŸ”¥ Destaques da Semana</h3>
                <button onclick="app.closeModal('promo-modal')" style="border:none; background:none; font-size:1.5rem;">Ã—</button>
            </div>
            <div class="carousel-wrapper" style="padding: 30px;">
                <div id="promo-track" class="promo-list-container"></div>
            </div>
        </div>
    </div>

    <div id="product-modal" class="overlay">
        <div class="box" style="padding: 25px; height: 90vh; max-height: 800px;">
            <div class="product-modal-grid">
                <div class="pm-images" id="m-media-area"></div>
                <div class="pm-details">
                    <button onclick="app.closeModal('product-modal')" style="align-self: flex-end; border:none; background:none; font-size:1.5rem; color:#999; cursor: pointer;">Ã—</button>
                    <small id="m-cat" style="color:var(--primary); font-weight:800; text-transform:uppercase; margin-bottom: 5px;">Categoria</small>
                    <h2 id="m-title" style="margin:0 0 10px; font-family: var(--font-serif); font-size: 2.5rem; line-height: 1.1;"></h2>
                    <h3 id="m-price" class="pm-price-tag"></h3>
                    <div class="pm-desc-box"><p id="m-desc"></p></div>
                    <div style="margin-bottom:25px;">
                        <label style="font-weight:bold; font-size:0.9rem; margin-bottom:10px; display:block;">Escolha sua variaÃ§Ã£o:</label>
                        <div id="m-vars" class="var-chip-container"></div>
                    </div>
                    <div style="margin-top: auto;">
                        <div style="margin-bottom: 15px; color:#27ae60; font-weight:600; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-truck"></i> Entrega RÃ¡pida (03-05 dias)
                        </div>
                        <div style="display:flex; gap:15px;">
                            <div style="border:1px solid #ddd; border-radius:50px; display:flex; align-items: center; height: 55px; padding: 0 5px;">
                                <button onclick="app.updQty(-1)" style="padding:0 15px; border:none; background:transparent; font-size: 1.2rem;">-</button>
                                <span id="m-qty" style="font-weight:bold; width: 25px; text-align: center;">1</span>
                                <button onclick="app.updQty(1)" style="padding:0 15px; border:none; background:transparent; font-size: 1.2rem;">+</button>
                            </div>
                            <button onclick="app.addCart()" class="btn-modern btn-cta" style="flex:1; height: 55px; margin-top: 0; border-radius: 50px;">Adicionar Ã  Sacola</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="sidebar">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;">
            <h2 style="font-family: var(--font-serif);">Sua Sacola</h2>
            <button onclick="app.toggleCart()" style="border:none; background:none; font-size:1.5rem; color:#999;">Ã—</button>
        </div>
        <div style="flex:1; overflow-y:auto; padding-right: 5px;">
            <ul id="cart-list" style="list-style:none;"></ul>
        </div>
        <div style="border-top:1px solid #eee; padding-top:25px;">
            <div id="cart-auth-area" style="margin-bottom:15px;"></div>
            <button id="btn-address-trigger" onclick="app.openAddressModal()" class="btn-addr-trigger">
                <i class="fas fa-map-marker-alt"></i> Cadastrar local de entrega
            </button>
            <div style="background: #fafafa; padding: 20px; border-radius: 16px; margin-bottom: 20px; display:flex; justify-content:space-between; align-items:center;">
                <span style="color:#666;">Total</span>
                <span id="cart-total" style="font-size: 1.5rem; font-weight: 800; color: var(--accent);">R$ 0.00</span>
            </div>
            <button onclick="app.checkout('whatsapp')" class="btn-modern btn-whatsapp" style="width: 100%; margin-bottom: 10px;">
                <i class="fab fa-whatsapp"></i> Finalizar no WhatsApp
            </button>
            <button onclick="app.checkout('mercadopago')" class="btn-modern btn-mp" style="width: 100%;">
                <i class="fas fa-qrcode"></i> Pagar Agora (Pix/CartÃ£o)
            </button>
        </div>
    </div>

    <div id="address-modal" class="overlay"><div class="box single-col" style="padding: 30px;"><div id="saved-addresses-list"></div><h4 style="margin-top:20px">Novo EndereÃ§o</h4><input id="addr-cep" class="input" placeholder="CEP" onblur="app.fetchCep(this.value)"><input id="addr-street" class="input" placeholder="Rua"><div class="input-row"><input id="addr-num" class="input" placeholder="NÂº"><input id="addr-bairro" class="input" placeholder="Bairro"></div><div class="input-row"><input id="addr-city" class="input" placeholder="Cidade"><input id="addr-uf" class="input" placeholder="UF"></div><input id="addr-name" class="input" placeholder="Nome Recebedor"><input id="addr-phone" class="input" placeholder="Telefone"><select id="addr-type" class="input"><option value="Casa">Casa</option></select><button onclick="app.addNewAddress()" class="btn-modern success" style="width:100%">Salvar</button><button onclick="app.closeModal('address-modal')" class="btn-modern outline" style="width:100%; margin-top:10px">Fechar</button></div></div>

    <div id="auth-modal" class="overlay"><div class="box single-col" style="padding:40px; text-align:center;"><h2 style="margin-bottom:20px;">Acesse sua conta</h2><div id="form-login"><input type="email" id="l-email" class="input" placeholder="E-mail"><input type="password" id="l-pass" class="input" placeholder="Senha"><button onclick="auth.login()" class="btn-modern" style="width:100%">Entrar</button><p style="margin-top:15px"><a href="#" onclick="auth.toggle('register')">Criar conta</a></p></div><div id="form-register" style="display:none;"><input id="r-name" class="input" placeholder="Nome"><input id="r-email" class="input" placeholder="E-mail"><input id="r-pass" type="password" class="input" placeholder="Senha"><button onclick="auth.register()" class="btn-modern" style="width:100%">Cadastrar</button><p style="margin-top:15px"><a href="#" onclick="auth.toggle('login')">Voltar</a></p></div><button onclick="app.closeModal('auth-modal')" style="position:absolute; top:20px; right:20px; border:none; background:none; font-size:1.5rem;">Ã—</button></div></div>
    
    <div id="admin-auth-modal" class="overlay">
        <div class="box single-col" style="max-width: 350px; padding: 40px; text-align: center;">
            <i class="fas fa-fingerprint" style="font-size: 3rem; color: var(--accent); margin-bottom: 20px;"></i>
            <h3>Portal Admin</h3>
            <input type="email" id="admin-email" class="input" placeholder="Admin Email" value="loja@2amoda.com">
            <input type="password" id="admin-pass" class="input" placeholder="Senha" onkeydown="if(event.key==='Enter') admin.verifyLogin()">
            <button onclick="admin.verifyLogin()" class="btn-modern" style="width:100%; margin-top: 10px;">Acessar Painel</button>
            <button onclick="app.closeModal('admin-auth-modal')" style="background:none; border:none; color:#999; margin-top:15px; text-decoration: underline;">Cancelar</button>
        </div>
    </div>

    <div id="admin-modal" class="overlay" style="z-index:2001; background:#f4f6f9; align-items:flex-start; padding:0;">
        <div class="box" style="max-width:100%; height:100%; border-radius:0; padding:0; display:flex; flex-direction:column; background: #fdfbf7;">
            
            <div class="admin-nav" style="padding: 15px 20px; background: white; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <h3 style="color: var(--accent);">Admin 2A</h3>
                    <div style="height: 25px; width: 1px; background: #ddd;"></div>
                    <button onclick="admin.tab('unified')" class="admin-tab active"><i class="fas fa-chart-pie"></i> GestÃ£o Unificada</button>
                    <button onclick="admin.tab('stock')" class="admin-tab"><i class="fas fa-boxes"></i> Estoque</button>
                    <button onclick="admin.tab('prod')" class="admin-tab"><i class="fas fa-tshirt"></i> Produtos</button>
                </div>
                <button onclick="admin.logout()" class="btn-modern outline small">Sair</button>
            </div>

            <div style="flex:1; overflow-y:auto; padding:30px; width:100%; max-width:1300px; margin:0 auto;">
                
                <div id="tab-unified">
                    <div class="kpi-grid">
                        <div class="kpi-card highlight">
                            <h4>Total a Receber (Em Aberto)</h4>
                            <div class="val" id="kpi-to-receive">R$ 0.00</div>
                            <small style="color: rgba(255,255,255,0.8); margin-top: 5px;">Soma de pendÃªncias e parcelas futuras</small>
                        </div>
                        <div class="kpi-card">
                            <h4>Receita Real (Caixa)</h4>
                            <div class="val" id="kpi-revenue" style="color: var(--success);">R$ 0.00</div>
                        </div>
                        <div class="kpi-card">
                            <h4>Vendas Totais (MÃªs)</h4>
                            <div class="val" id="kpi-sales">R$ 0.00</div>
                        </div>
                        <button onclick="admin.tab('new-order')" class="btn-modern" style="height: 100%; justify-content: center; font-size: 1.1rem;">
                            <i class="fas fa-plus-circle"></i> Novo Pedido Manual
                        </button>
                    </div>

                    <div class="admin-toolbar">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="unified-search" class="input" placeholder="Buscar Cliente, Pedido ou Tel..." onkeyup="admin.renderUnified(true)">
                        </div>
                        <div style="display:flex; gap: 10px; align-items: center;">
                            <input type="text" id="unified-start" class="flatpickr-input compact-date" placeholder="De" onchange="admin.renderUnified()">
                            <input type="text" id="unified-end" class="flatpickr-input compact-date" placeholder="AtÃ©" onchange="admin.renderUnified()">
                            <select id="unified-filter-pay" class="input" style="width: auto; margin:0;" onchange="admin.renderUnified(true)">
                                <option value="all">Todos Financeiro</option>
                                <option value="debt">ðŸ”´ Em Aberto (Deve)</option>
                                <option value="paid">ðŸŸ¢ Quitado</option>
                            </select>
                        </div>
                    </div>

                    <div id="unified-list"></div>
                </div>

                <div id="tab-stock" style="display:none;">
                    <div class="kpi-grid">
                         <div class="kpi-card"><h4>Valor em Estoque</h4><div class="val" id="st-rev">R$ 0.00</div></div>
                         <div class="kpi-card"><h4>Custo Total</h4><div class="val" id="st-cost">R$ 0.00</div></div>
                         <div class="kpi-card"><h4>Qtd Itens</h4><div class="val" id="st-qty">0</div></div>
                    </div>
                    <div id="dash-stock-grid" class="dashboard-grid"></div>
                </div>

                <div id="tab-prod" style="display:none;">
                    <div style="background:white; padding:30px; border-radius:20px; box-shadow: var(--shadow); margin-bottom: 30px;">
                        <h3>Cadastro de Produto</h3>
                        <div style="display:grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-top: 20px;">
                            <div>
                                <input type="hidden" id="edit-id">
                                <input type="text" id="f-name" class="input" placeholder="Nome do Produto">
                                <div class="input-row">
                                    <select id="f-cat" class="input"><option value="feminino">Feminino</option><option value="infantil">Infantil</option><option value="perfumes">Perfumes</option></select>
                                    <input type="number" id="f-cost" class="input" placeholder="Custo">
                                </div>
                                <div class="input-row">
                                    <input type="number" id="f-price-global" class="input" placeholder="PreÃ§o Venda (PadrÃ£o)">
                                    <input type="number" id="f-stock-global" class="input" placeholder="Estoque (PadrÃ£o)">
                                </div>
                                <div style="margin:15px 0;">
                                    <label class="toggle-switch"><input type="checkbox" id="f-promo"><span class="slider"></span></label> <span>Em PromoÃ§Ã£o?</span>
                                </div>
                                <textarea id="f-desc" class="input" rows="3" placeholder="DescriÃ§Ã£o Detalhada"></textarea>
                            </div>
                            <div>
                                <div class="file-upload-wrapper" onclick="document.getElementById('f-file').click()">
                                    <i class="fas fa-camera"></i> <p>Fotos/VÃ­deos</p>
                                    <input type="file" id="f-file" multiple accept="image/*,video/*" onchange="admin.handleFileSelect(this)">
                                </div>
                                <div id="file-preview-area" class="file-preview-grid"></div>
                            </div>
                        </div>
                        
                        <hr style="margin:20px 0; border:0; border-top:1px solid #eee;">
                        <h4>VariaÃ§Ãµes (Cores e Tamanhos)</h4>
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-top:10px;">
                            <div><div id="color-checks" class="modern-checkbox-grid"></div></div>
                            <div><div id="volume-checks" class="modern-checkbox-grid"></div></div>
                        </div>
                        <div id="active-vars-area" style="margin-top:15px;"></div>
                        
                        <div style="display:flex; gap:10px; margin-top:20px;">
                            <button onclick="admin.save()" id="btn-save" class="btn-modern success" style="flex:2;">Salvar Produto</button>
                            <button onclick="admin.clear()" class="btn-modern outline" style="flex:1;">Limpar</button>
                        </div>
                    </div>
                    <div style="background:white; padding:25px; border-radius:20px; box-shadow: var(--shadow);">
                        <h3>InventÃ¡rio</h3>
                        <div id="admin-list" style="margin-top:20px;"></div>
                    </div>
                </div>

                <div id="tab-new-order" style="display:none;">
                    <button onclick="admin.tab('unified')" class="btn-modern outline small" style="margin-bottom:15px;">&larr; Voltar</button>
                    <div style="background:white; padding:30px; border-radius:20px; box-shadow: var(--shadow); max-width: 900px; margin: 0 auto;">
                        <h3>Criar Pedido Manual</h3>
                        <div class="manual-order-grid">
                            <div>
                                <h4>Dados do Cliente</h4>
                                <input id="m-client-name" class="input" placeholder="Nome">
                                <input id="m-client-phone" class="input" placeholder="WhatsApp">
                                <input id="m-client-cep" class="input" placeholder="CEP" onblur="app.fetchCep(this.value, 'manual')">
                                <input id="m-client-street" class="input" placeholder="Rua">
                                <div class="input-row"><input id="m-client-num" class="input" placeholder="NÂº"><input id="m-client-bairro" class="input" placeholder="Bairro"></div>
                                <div class="input-row"><input id="m-client-city" class="input" placeholder="Cidade"><input id="m-client-uf" class="input" placeholder="UF"></div>
                                
                                <h4 style="margin-top:20px">Financeiro Inicial</h4>
                                <div class="input-row">
                                    <select id="m-payment-method" class="input"><option value="Dinheiro">Dinheiro</option><option value="Pix">Pix</option><option value="CartÃ£o">CartÃ£o</option><option value="CrediÃ¡rio">CrediÃ¡rio/Fiado</option></select>
                                    <select id="m-payment-status" class="input"><option value="Pago">Pago (Total)</option><option value="Pendente">A Pagar</option></select>
                                </div>
                            </div>
                            <div>
                                <h4>Itens</h4>
                                <div class="manual-prod-adder">
                                    <select id="m-prod-select" class="input" style="flex:2"></select>
                                    <input type="number" id="m-prod-qty" class="input" value="1" style="width:60px; text-align:center;">
                                    <button onclick="admin.addManualItem()" class="btn-modern small"><i class="fas fa-plus"></i></button>
                                </div>
                                <div class="manual-cart-list" id="manual-cart-list"></div>
                                <h3 style="text-align:right; margin-top:15px; color:var(--accent);">Total: <span id="m-total-display">R$ 0.00</span></h3>
                                <button onclick="admin.saveManualOrder()" class="btn-modern success" style="width:100%; margin-top:15px;">Confirmar Venda</button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
