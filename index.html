<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2A Modas e Perfumes</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>

    <style>
        /* --- ESTILOS GERAIS --- */
        :root {
            --primary: #c48b78; 
            --text-main: #2c3e50;
            --bg-body: #fcfcfc;
            --radius: 12px;
        }
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Inter',sans-serif; outline:none; }
        body { background: var(--bg-body); color: var(--text-main); }
        h1,h2,h3 { font-family:'Montserrat',sans-serif; }
        button { cursor:pointer; transition:0.3s; }

        /* --- HEADER & HERO --- */
        header { position:fixed; top:0; width:100%; background:rgba(255,255,255,0.95); padding:15px 5%; display:flex; justify-content:flex-end; z-index:1000; backdrop-filter:blur(5px); border-bottom:1px solid #eee; }
        .cart-btn { background:white; border:1px solid #ddd; width:45px; height:45px; border-radius:50%; font-size:1.2rem; position:relative; }
        .cart-badge { position:absolute; top:-5px; right:-5px; background:var(--primary); color:white; width:20px; height:20px; border-radius:50%; font-size:0.7rem; display:flex; align-items:center; justify-content:center; }

        .hero { padding:120px 20px 60px; text-align:center; background:radial-gradient(circle at top, #fff5f2 0%, #fff 100%); }
        .brand-img { width:180px; height:180px; border-radius:50%; object-fit:cover; border:5px solid white; box-shadow:0 10px 30px rgba(0,0,0,0.1); margin-bottom:20px; animation:float 6s infinite; }
        @keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-10px)} }
        .btn-cta { background:var(--text-main); color:white; border:none; padding:12px 30px; border-radius:30px; margin-top:20px; }

        /* --- PRODUTOS --- */
        .container { max-width:1200px; margin:0 auto; padding:40px 20px; }
        .nav-filters { display:flex; justify-content:center; gap:10px; margin-bottom:40px; flex-wrap:wrap; }
        .filter-btn { border:1px solid #ddd; background:transparent; padding:8px 20px; border-radius:20px; color:#666; }
        .filter-btn.active { background:var(--text-main); color:white; border-color:var(--text-main); }

        .products-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(260px, 1fr)); gap:30px; }
        .product-card { background:white; border-radius:var(--radius); overflow:hidden; border:1px solid #f0f0f0; transition:0.3s; position:relative; }
        .product-card:hover { transform:translateY(-5px); box-shadow:0 10px 30px rgba(0,0,0,0.08); }
        .card-img { height:320px; width:100%; object-fit:cover; background:#f9f9f9; }
        .card-info { padding:15px; text-align:center; }
        
        .stock-tag { position:absolute; top:10px; left:10px; background:rgba(255,255,255,0.9); padding:5px; font-size:0.7rem; font-weight:bold; border-radius:4px; }
        
        /* --- MODAL --- */
        .modal-overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:2000; display:none; align-items:center; justify-content:center; padding:20px; }
        .modal-overlay.active { display:flex; }
        .modal-box { background:white; width:100%; max-width:900px; display:grid; grid-template-columns:1fr 1fr; border-radius:15px; overflow:hidden; max-height:90vh; overflow-y:auto; }
        .modal-content { padding:40px; position:relative; }
        
        /* --- ADMIN & LOGIN --- */
        #admin-panel { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#f4f6f9; z-index:3000; overflow-y:auto; padding:20px; }
        #admin-panel.active { display:block; }
        .admin-box { max-width:800px; margin:0 auto; background:white; padding:30px; border-radius:15px; box-shadow:0 5px 20px rgba(0,0,0,0.05); }
        
        .form-input { width:100%; padding:10px; border:1px solid #ddd; border-radius:8px; margin-bottom:15px; }
        .file-upload-label { display:block; padding:20px; border:2px dashed #ddd; text-align:center; cursor:pointer; border-radius:8px; margin-bottom:15px; color:#666; transition:0.3s; }
        .file-upload-label:hover { border-color:var(--primary); background:#fff5f2; color:var(--primary); }

        /* --- BOTÕES DO CARRINHO --- */
        .hidden { display:none !important; }
        
        /* Botão Mercado Pago Ajustado */
        .btn-mp { 
            background:#009EE3; color:white; width:100%; padding:15px; 
            border:none; border-radius:8px; display:flex; 
            align-items:center; justify-content:center; gap:10px; 
            margin-top:10px; font-weight: 600;
        }
        .btn-mp:hover { background: #007eb5; }
        .mp-icon-img { height: 24px; width: auto; display: block; filter: brightness(0) invert(1); } /* Ícone branco */

        .btn-whats { 
            background:#25D366; color:white; width:100%; padding:15px; 
            border:none; border-radius:8px; display:flex; 
            align-items:center; justify-content:center; gap:10px; 
            font-weight: 600;
        }
        .btn-whats:hover { background: #1ebc57; }
        
        /* Cart Sidebar */
        .cart-sidebar { position:fixed; top:0; right:-400px; width:350px; height:100%; background:white; z-index:2001; padding:20px; transition:0.3s; box-shadow:-5px 0 20px rgba(0,0,0,0.1); display:flex; flex-direction:column; }
        .cart-sidebar.open { right:0; }

        @media(max-width:768px){ .modal-box{grid-template-columns:1fr;} .cart-sidebar{width:100%;} }
        
        /* Loading Spinner */
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid var(--primary); border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display:inline-block; margin-right:10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <header>
        <button class="cart-btn" onclick="app.toggleCart()">
            <i class="fas fa-shopping-bag"></i>
            <span class="cart-badge" id="cart-count">0</span>
        </button>
    </header>

    <div class="hero">
        <img src="logo.jpg" class="brand-img" onerror="this.src='https://via.placeholder.com/200'">
        <h1 style="font-size:2.5rem; margin-bottom:10px;">2A Modas e Perfumes</h1>
        <p>Estilo e essência em um só lugar.</p>
        <button class="btn-cta" onclick="document.getElementById('vitrine').scrollIntoView({behavior:'smooth'})">Ver Coleção</button>
    </div>

    <div class="container" id="vitrine">
        <nav class="nav-filters">
            <button class="filter-btn active" onclick="app.filter('all', this)">Todos</button>
            <button class="filter-btn" onclick="app.filter('feminino', this)">Feminino</button>
            <button class="filter-btn" onclick="app.filter('infantil', this)">Infantil</button>
            <button class="filter-btn" onclick="app.filter('perfumes', this)">Perfumes</button>
        </nav>
        
        <div id="loading-products" style="text-align:center; padding:20px;">
            <div class="loader"></div> Carregando produtos...
        </div>

        <div class="products-grid" id="products-list"></div>
    </div>

    <div class="modal-overlay" id="product-modal">
        <div class="modal-box">
            <img id="m-img" style="width:100%; height:100%; object-fit:cover; min-height:300px;">
            <div class="modal-content">
                <button onclick="document.getElementById('product-modal').classList.remove('active')" style="position:absolute; top:20px; right:20px; border:none; background:none; font-size:1.5rem;">&times;</button>
                <small id="m-cat" style="text-transform:uppercase; color:#999;">Cat</small>
                <h2 id="m-title" style="margin:10px 0;">Produto</h2>
                <div id="m-price" style="font-size:1.5rem; color:var(--primary); font-weight:bold; margin-bottom:20px;">R$ 0,00</div>
                <p id="m-desc" style="color:#666; margin-bottom:20px; line-height:1.6;">Desc</p>
                
                <div id="m-opts-area" style="margin-bottom:20px;"></div>

                <div style="display:flex; align-items:center; gap:10px; margin-bottom:20px;">
                    <strong>Qtd:</strong>
                    <button onclick="app.updQty(-1)" style="padding:5px 10px;">-</button>
                    <span id="m-qty">1</span>
                    <button onclick="app.updQty(1)" style="padding:5px 10px;">+</button>
                </div>

                <button id="btn-add" onclick="app.addCart()" style="width:100%; background:var(--text-main); color:white; padding:15px; border:none; border-radius:8px;">Adicionar à Sacola</button>
            </div>
        </div>
    </div>

    <div class="cart-sidebar">
        <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
            <h3>Sacola</h3>
            <button onclick="app.toggleCart()" style="border:none; background:none; font-size:1.5rem;">&times;</button>
        </div>
        <ul id="cart-list" style="flex:1; overflow-y:auto; list-style:none;"></ul>
        <div style="border-top:1px solid #eee; padding-top:20px;">
            <div style="display:flex; justify-content:space-between; font-weight:bold; margin-bottom:10px;">
                <span>Total</span> <span id="cart-total">R$ 0.00</span>
            </div>
            
            <button class="btn-whats" onclick="app.checkoutWs()">
                <i class="fab fa-whatsapp"></i> Pedir no WhatsApp
            </button>
            
            <button class="btn-mp" onclick="app.checkoutMp()">
                <img src="https://logopng.com.br/logos/mercado-pago-85.png" alt="MP" class="mp-icon-img">
                Pagar com Mercado Pago
            </button>
        </div>
    </div>

    <div class="modal-overlay" id="login-modal">
        <div style="background:white; padding:40px; border-radius:15px; text-align:center;">
            <h3>Acesso Restrito</h3>
            <input type="email" id="adm-email" placeholder="E-mail" class="form-input" style="margin-top:15px;">
            <input type="password" id="adm-pass" placeholder="Senha" class="form-input">
            <button onclick="admin.login()" style="background:var(--primary); color:white; padding:10px 30px; border:none; border-radius:5px;">Entrar</button>
            <br><br>
            <button onclick="document.getElementById('login-modal').classList.remove('active')" style="background:none; border:none; color:#999;">Cancelar</button>
        </div>
    </div>

    <div id="admin-panel">
        <div class="admin-box">
            <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
                <h2>Gerenciar Produtos</h2>
                <button onclick="admin.logout()" style="background:red; color:white; border:none; padding:5px 15px; border-radius:5px;">Sair</button>
            </div>

            <form onsubmit="admin.save(event)">
                <input type="hidden" id="edit-id">
                
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px;">
                    <input type="text" id="f-name" class="form-input" placeholder="Nome do Produto" required>
                    <input type="number" id="f-price" class="form-input" placeholder="Preço" step="0.01" required>
                </div>

                <label class="file-upload-label" id="upload-label">
                    <i class="fas fa-cloud-upload-alt" style="font-size:2rem; margin-bottom:10px;"></i><br>
                    <span id="file-text">Clique para selecionar uma foto</span>
                    <input type="file" id="f-file" accept="image/*" style="display:none;" onchange="admin.previewFile()">
                </label>
                <img id="f-preview" style="width:100px; height:100px; object-fit:cover; display:none; margin-bottom:15px; border-radius:8px;">

                <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px;">
                    <select id="f-cat" class="form-input">
                        <option value="feminino">Feminino</option>
                        <option value="infantil">Infantil</option>
                        <option value="perfumes">Perfumes</option>
                    </select>
                    <input type="number" id="f-stock" class="form-input" placeholder="Estoque" required>
                </div>

                <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px;">
                    <select id="f-type" class="form-input">
                        <option value="color">Cores</option>
                        <option value="volume">Volume (ml)</option>
                    </select>
                    <input type="text" id="f-opts" class="form-input" placeholder="Opções (ex: Azul, Preto)" required>
                </div>

                <textarea id="f-desc" class="form-input" rows="3" placeholder="Descrição"></textarea>

                <button type="submit" id="btn-save" style="width:100%; background:green; color:white; padding:15px; border:none; border-radius:8px; font-weight:bold;">
                    Salvar Produto
                </button>
                <button type="button" onclick="admin.clear()" style="width:100%; background:#eee; padding:10px; border:none; margin-top:10px; border-radius:8px;">Limpar</button>
            </form>

            <div style="margin-top:30px;">
                <h3>Produtos Cadastrados</h3>
                <div id="admin-list"></div>
            </div>
        </div>
    </div>

    <footer style="text-align:center; padding:40px; color:#aaa; font-size:0.8rem;">
        &copy; 2025 2A Modas.<br><br>
        <button onclick="document.getElementById('login-modal').classList.add('active')" style="background:none; border:none; color:#ddd;">Admin</button>
    </footer>

    <script>
        // --- 1. CONFIGURAÇÃO FIREBASE (COLE SUAS CHAVES AQUI) ---
        const firebaseConfig = {
<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-analytics.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyB1Z3Vy5-wVfJ7yelQ7b_GakJWjhmD338o",
    authDomain: "loja2a.firebaseapp.com",
    projectId: "loja2a",
    storageBucket: "loja2a.firebasestorage.app",
    messagingSenderId: "864712234172",
    appId: "1:864712234172:web:670edd2de6d85fb118acb9",
    measurementId: "G-26EMJRJ3EY"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
</script>
        };

        // URL da Cloud Function para pagamento
        const CLOUD_URL = "https://criarpagamentoss-967029810770.southamerica-east1.run.app"; 

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();

        // Estado da Aplicação
        const state = { products: [], cart: [], current: null, var: null, qty: 1 };

        // --- APP PRINCIPAL ---
        const app = {
            init: async () => {
                document.getElementById('loading-products').style.display = 'block';
                try {
                    db.collection("products").onSnapshot((querySnapshot) => {
                        state.products = [];
                        querySnapshot.forEach((doc) => {
                            state.products.push({ id: doc.id, ...doc.data() });
                        });
                        app.render(state.products);
                        admin.renderList();
                        document.getElementById('loading-products').style.display = 'none';
                    });
                } catch (e) {
                    console.error("Erro Firebase:", e);
                    alert("Erro ao conectar no banco de dados. Verifique a configuração.");
                }
            },

            render: (list) => {
                const div = document.getElementById('products-list'); div.innerHTML = "";
                if(list.length === 0) div.innerHTML = "<p>Nenhum produto cadastrado.</p>";
                
                list.forEach(p => {
                    const stockTag = p.stock < 1 ? '<div class="stock-tag" style="background:red; color:white;">Esgotado</div>' : '';
                    div.innerHTML += `
                        <div class="product-card" onclick="app.modal('${p.id}')">
                            ${stockTag}
                            <img src="${p.image}" class="card-img">
                            <div class="card-info">
                                <small style="text-transform:uppercase; color:#999;">${p.category}</small>
                                <div style="font-weight:600; margin:5px 0;">${p.name}</div>
                                <div style="color:var(--primary); font-weight:bold;">R$ ${parseFloat(p.price).toFixed(2)}</div>
                            </div>
                        </div>`;
                });
            },

            filter: (cat, btn) => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                app.render(cat === 'all' ? state.products : state.products.filter(p => p.category === cat));
            },

            modal: (id) => {
                const p = state.products.find(x => x.id === id);
                state.current = p; state.qty = 1; state.var = null;
                
                document.getElementById('m-img').src = p.image;
                document.getElementById('m-title').innerText = p.name;
                document.getElementById('m-price').innerText = `R$ ${parseFloat(p.price).toFixed(2)}`;
                document.getElementById('m-desc').innerText = p.desc;
                document.getElementById('m-cat').innerText = p.category;
                document.getElementById('m-qty').innerText = 1;

                const optsDiv = document.getElementById('m-opts-area'); optsDiv.innerHTML = "<strong>Opções:</strong><br>";
                p.options.forEach(opt => {
                    optsDiv.innerHTML += `<button onclick="app.selVar('${opt}', this)" style="margin:5px 5px 0 0; padding:8px; border:1px solid #ddd; background:white; border-radius:5px;">${opt}</button>`;
                });

                document.getElementById('product-modal').classList.add('active');
            },

            selVar: (val, el) => {
                state.var = val;
                const btns = document.getElementById('m-opts-area').getElementsByTagName('button');
                for(let b of btns) b.style.background = 'white';
                el.style.background = '#ddd';
            },

            updQty: (n) => {
                state.qty += n; if(state.qty < 1) state.qty = 1;
                document.getElementById('m-qty').innerText = state.qty;
            },

            addCart: () => {
                if(!state.var) return alert("Selecione uma opção");
                state.cart.push({ ...state.current, qty: state.qty, variant: state.var });
                app.renderCart();
                document.getElementById('product-modal').classList.remove('active');
                app.toggleCart();
            },

            renderCart: () => {
                const ul = document.getElementById('cart-list'); ul.innerHTML = "";
                let total = 0;
                state.cart.forEach((item, idx) => {
                    const sub = item.price * item.qty; total += sub;
                    ul.innerHTML += `
                    <li style="display:flex; justify-content:space-between; margin-bottom:15px; border-bottom:1px solid #eee; padding-bottom:10px;">
                        <div>
                            <strong>${item.name}</strong><br>
                            <small>${item.variant} x${item.qty}</small>
                        </div>
                        <div style="text-align:right">
                            R$ ${sub.toFixed(2)}<br>
                            <small onclick="state.cart.splice(${idx},1); app.renderCart()" style="color:red; cursor:pointer;">remover</small>
                        </div>
                    </li>`;
                });
                document.getElementById('cart-total').innerText = `R$ ${total.toFixed(2)}`;
                document.getElementById('cart-count').innerText = state.cart.length;
            },

            toggleCart: () => document.querySelector('.cart-sidebar').classList.toggle('open'),

            checkoutWs: () => {
                if(!state.cart.length) return alert("Carrinho vazio");
                let msg = "Olá! Pedido 2A Modas:\n\n"; let t=0;
                state.cart.forEach(i => { msg += `${i.name} (${i.variant}) x${i.qty}\n`; t += i.price * i.qty; });
                msg += `\nTotal: R$ ${t.toFixed(2)}`;
                window.open(`https://wa.me/5511999999999?text=${encodeURIComponent(msg)}`);
            },

            checkoutMp: async () => {
                if(!state.cart.length) return alert("Carrinho vazio");
                const btn = document.querySelector('.btn-mp');
                const originalText = btn.innerHTML;
                btn.innerText = "Processando..."; btn.disabled = true;
                
                try {
                    const items = state.cart.map(i => ({ name: i.name, price: i.price, qty: i.qty, variant: i.variant }));
                    const res = await fetch(CLOUD_URL, {
                        method: 'POST', headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ items })
                    });
                    const data = await res.json();
                    if(data.init_point) window.location.href = data.init_point;
                    else alert("Erro ao gerar link");
                } catch(e) {
                    console.error(e); alert("Erro conexão");
                } finally {
                    btn.innerHTML = originalText; btn.disabled = false;
                }
            }
        };

        // --- ADMINISTRAÇÃO ---
        const admin = {
            login: () => {
                const e = document.getElementById('adm-email').value;
                const p = document.getElementById('adm-pass').value;
                if(e === "admin@2amodas.com" && p === "admin123") {
                    document.getElementById('login-modal').classList.remove('active');
                    document.getElementById('admin-panel').classList.add('active');
                } else alert("Dados incorretos");
            },
            logout: () => document.getElementById('admin-panel').classList.remove('active'),

            previewFile: () => {
                const file = document.getElementById('f-file').files[0];
                if (file) {
                    document.getElementById('file-text').innerText = file.name;
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const img = document.getElementById('f-preview');
                        img.src = e.target.result;
                        img.style.display = 'block';
                    }
                    reader.readAsDataURL(file);
                }
            },

            save: async (e) => {
                e.preventDefault();
                const btn = document.getElementById('btn-save');
                btn.innerText = "Enviando..."; btn.disabled = true;

                try {
                    const file = document.getElementById('f-file').files[0];
                    let imageUrl = "";

                    if (file) {
                        const ref = storage.ref(`produtos/${Date.now()}_${file.name}`);
                        await ref.put(file);
                        imageUrl = await ref.getDownloadURL();
                    } else {
                        if(!document.getElementById('edit-id').value) imageUrl = "https://via.placeholder.com/300";
                    }

                    const data = {
                        name: document.getElementById('f-name').value,
                        price: parseFloat(document.getElementById('f-price').value),
                        category: document.getElementById('f-cat').value,
                        stock: parseInt(document.getElementById('f-stock').value),
                        type: document.getElementById('f-type').value,
                        options: document.getElementById('f-opts').value.split(',').map(s=>s.trim()),
                        desc: document.getElementById('f-desc').value
                    };
                    if(imageUrl) data.image = imageUrl;

                    const id = document.getElementById('edit-id').value;
                    if(id) {
                        await db.collection("products").doc(id).update(data);
                    } else {
                        await db.collection("products").add(data);
                    }

                    alert("Salvo!");
                    admin.clear();

                } catch (error) {
                    console.error("Erro:", error);
                    alert("Erro ao salvar: " + error.message);
                } finally {
                    btn.innerText = "Salvar Produto"; btn.disabled = false;
                }
            },

            clear: () => {
                document.querySelector('form').reset();
                document.getElementById('edit-id').value = "";
                document.getElementById('f-preview').style.display = 'none';
                document.getElementById('file-text').innerText = "Clique para selecionar uma foto";
            },

            renderList: () => {
                const list = document.getElementById('admin-list'); list.innerHTML = "";
                state.products.forEach(p => {
                    list.innerHTML += `
                    <div style="display:flex; justify-content:space-between; align-items:center; padding:10px; border-bottom:1px solid #eee;">
                        <div style="display:flex; align-items:center;">
                            <img src="${p.image}" style="width:40px; height:40px; object-fit:cover; border-radius:5px; margin-right:10px;">
                            <strong>${p.name}</strong>
                        </div>
                        <div>
                            <button onclick="admin.del('${p.id}')" style="color:red; background:none; border:none;">Excluir</button>
                        </div>
                    </div>`;
                });
            },

            del: async (id) => {
                if(confirm("Tem certeza?")) {
                    await db.collection("products").doc(id).delete();
                }
            }
        };

        app.init();
    </script>
</body>
</html>
